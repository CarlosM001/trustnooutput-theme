{% comment %}
  TRUST.NO.OUTPUT — Header Section

  A minimalist cyberpunk-inspired header featuring:
  - Text logo with glitch hover effect
  - Centered navigation with color-shift hover
  - Icon-based utilities (Search, Account, Cart)
  - Sticky behavior with backdrop blur on scroll
  - Mobile-responsive with full-screen menu overlay
  - "Reality is under construction" tooltip on logo hover

  Philosophy: The header is a portal—not just navigation,
  but a digital interface that reveals its constructed nature
  through subtle glitches and fragmentations.

  CSS: All styles moved to assets/custom.css for cacheability.
  JS: Interaction logic in assets/header.js.
{% endcomment %}

{%- comment -%}
  ==================================================================================
  NOTE: All header CSS has been moved to assets/custom.css (section 11-13).
  This keeps the Liquid template clean and improves browser caching.
  ==================================================================================
{%- endcomment -%}

{%- comment -%}
  All header styling consolidated in assets/custom.css (sections 11-13).
  This improves performance via browser caching and reduces duplication.
{%- endcomment -%}

<header
  class="site-header tno-header header--tno {% if section.settings.transparent_header %}is-transparent{% endif %}"
  id="site-header"
>
  <div class="site-header__inner">
    {%- comment %} Logo (Left) {%- endcomment %}
    <div class="header-logo">
      <a
        href="{{ routes.root_url }}"
        class="header-logo__link"
        data-text="TRUST.NO.OUTPUT"
        data-tooltip="Reality is under construction"
      >
        TRUST.NO.OUTPUT
      </a>
    </div>

    {%- comment %} Navigation (Center) {%- endcomment %}
    <nav class="header-nav tno-nav" role="navigation" aria-label="Main">
      {%- assign menu_handle = section.settings.main_menu | default: section.settings.menu -%}
      {%- assign menu_ref = linklists[menu_handle] -%}
      {%- if menu_ref.links and menu_ref.links.size > 0 -%}
        <ul class="header-nav__list tno-nav__list">
          {% for link in menu_ref.links %}
            {%- assign has_mega = false -%}
            {%- assign mega_block = null -%}
            {%- for block in section.blocks -%}
              {%- if block.type == 'mega_menu' -%}
                {%- assign block_title = block.settings.title_match | strip | downcase -%}
                {%- assign link_title_down = link.title | strip | downcase -%}
                {%- if block_title != blank and block_title == link_title_down -%}
                  {%- assign has_mega = true -%}
                  {%- assign mega_block = block -%}
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
            <li class="header-nav__item tno-nav__item {% if has_mega %}tno-has-mega{% elsif link.links.size > 0 %}tno-has-dropdown{% endif %}">
              <a
                href="{{ link.url }}"
                class="header-nav__link tno-nav__link {% if link.active %}is-active{% endif %}"
              >
                {{ link.title }}
              </a>
              {%- if has_mega and mega_block -%}
                <button
                  class="tno-nav__toggle"
                  aria-expanded="false"
                  aria-controls="mega-{{ forloop.index }}-{{ section.id }}"
                  aria-label="Toggle {{ link.title }} menu"
                ></button>
                <div
                  class="tno-mega"
                  id="mega-{{ forloop.index }}-{{ section.id }}"
                  data-panel="mega"
                  tabindex="-1"
                >
                  <div class="tno-mega__col">
                    <p class="tno-mega__title">
                      {{ mega_block.settings.col1_title | default: '// Shop by Category' }}
                    </p>
                    {%- assign col1_list = linklists[mega_block.settings.col1] -%}
                    {%- if col1_list and col1_list.links and col1_list.links.size > 0 -%}
                      <ul class="tno-mega__list">
                        {%- for l in col1_list.links -%}
                          <li>
                            <a class="tno-mega__link" href="{{ l.url }}">{{ l.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                  <div class="tno-mega__col">
                    <p class="tno-mega__title">
                      {{ mega_block.settings.col2_title | default: '// Shop by Style' }}
                    </p>
                    {%- assign col2_list = linklists[mega_block.settings.col2] -%}
                    {%- if col2_list and col2_list.links and col2_list.links.size > 0 -%}
                      <ul class="tno-mega__list">
                        {%- for l in col2_list.links -%}
                          <li>
                            <a class="tno-mega__link" href="{{ l.url }}">{{ l.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                  <div class="tno-mega__col">
                    <p class="tno-mega__title">
                      {{ mega_block.settings.col3_title | default: '// Drops' }}
                    </p>
                    {%- assign col3_list = linklists[mega_block.settings.col3] -%}
                    {%- if col3_list and col3_list.links and col3_list.links.size > 0 -%}
                      <ul class="tno-mega__list">
                        {%- for l in col3_list.links -%}
                          <li>
                            <a class="tno-mega__link" href="{{ l.url }}">{{ l.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                </div>
              {%- elsif link.links and link.links.size > 0 -%}
                <button
                  class="tno-nav__toggle"
                  aria-expanded="false"
                  aria-controls="dropdown-{{ forloop.index }}-{{ section.id }}"
                  aria-label="Toggle {{ link.title }} menu"
                ></button>
                <div
                  class="tno-dropdown"
                  id="dropdown-{{ forloop.index }}-{{ section.id }}"
                  data-panel="dropdown"
                >
                  <ul class="tno-dropdown__list">
                    {%- for child in link.links -%}
                      <li class="tno-dropdown__item">
                        <a class="tno-dropdown__link" href="{{ child.url }}">{{ child.title }}</a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              {%- endif -%}
            </li>
          {% endfor %}
        </ul>
      {%- else -%}
        {%- comment %}
          Fallback navigation: Product-Type Collections
          APPAREL | ACCESSORIES | PRINTS | ALL
        {%- endcomment %}
        <ul class="header-nav__list tno-nav__list">
          <li class="header-nav__item tno-nav__item">
            <a href="{{ routes.collections_url }}/apparel" class="header-nav__link tno-nav__link"
              >Apparel</a
            >
          </li>
          <li class="header-nav__item tno-nav__item">
            <a
              href="{{ routes.collections_url }}/accessories"
              class="header-nav__link tno-nav__link"
              >Accessories</a
            >
          </li>
          <li class="header-nav__item tno-nav__item">
            <a href="{{ routes.collections_url }}/prints" class="header-nav__link tno-nav__link"
              >Prints</a
            >
          </li>
          <li class="header-nav__item tno-nav__item">
            <a
              href="{{ routes.all_products_collection_url }}"
              class="header-nav__link tno-nav__link"
              >All</a
            >
          </li>
        </ul>
      {%- endif -%}
    </nav>

    {%- comment %} Icons (Right) {%- endcomment %}
    <div class="header-icons tno-nav__utility">
      {%- comment %} Search Field {%- endcomment %}
      {% if section.settings.show_search %}
        <div class="tno-search">
          <form action="{{ routes.search_url }}" method="get" role="search">
            <input
              type="search"
              name="q"
              placeholder="Search..."
              class="tno-search__input"
              aria-label="Search"
            >
            <button type="submit" class="tno-search__button" aria-label="Submit search">⌕</button>
          </form>
        </div>
      {% endif %}

      {%- comment %} Account Icon {%- endcomment %}
      {% if section.settings.show_account %}
        <a
          href="{{ routes.account_url }}"
          class="header-icon header-icon--account"
          aria-label="Account"
        >
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </a>
      {% endif %}

      {%- comment %} Cart Icon with Badge {%- endcomment %}
      <a
        href="{{ routes.cart_url }}"
        class="header-icon header-icon--cart tno-ico"
        aria-label="Cart"
      >
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <span class="cart-badge tno-badge" id="cart-count">
          {{ cart.item_count }}
        </span>
      </a>

      {%- comment %} Mobile Menu Toggle {%- endcomment %}
      <button
        class="header-menu-toggle"
        aria-label="Menu"
        id="mobile-menu-toggle"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </div>
</header>

{%- comment %} Mobile Menu Overlay {%- endcomment %}
<div
  class="mobile-menu"
  id="mobile-menu"
  role="dialog"
  aria-modal="true"
  aria-label="Main menu"
  aria-hidden="true"
  tabindex="-1"
>
  <nav class="mobile-menu__nav">
    {%- assign menu_ref = linklists[section.settings.menu] -%}
    <ul>
      {%- if menu_ref.links and menu_ref.links.size > 0 -%}
        {% for link in menu_ref.links %}
          {%- assign has_children = link.links.size | default: 0 -%}
          <li class="mobile-menu__item">
            <div class="mobile-menu__row">
              <a href="{{ link.url }}" class="mobile-menu__link">{{ link.title }}</a>
              {%- if has_children > 0 -%}
                <button
                  class="mobile-menu__toggle"
                  aria-expanded="false"
                  aria-controls="mm-sub-{{ forloop.index }}-{{ section.id }}"
                  aria-label="Untermenü {{ link.title }} umschalten"
                >
                  <span class="mobile-menu__chevron" aria-hidden="true">▾</span>
                </button>
              {%- endif -%}
            </div>
            {%- if has_children > 0 -%}
              <ul id="mm-sub-{{ forloop.index }}-{{ section.id }}" class="mobile-submenu" hidden>
                {% for child in link.links %}
                  <li class="mobile-submenu__item">
                    <a class="mobile-submenu__link" href="{{ child.url }}">{{ child.title }}</a>
                  </li>
                {% endfor %}
              </ul>
            {%- endif -%}
          </li>
        {% endfor %}
      {%- else -%}
        <li class="mobile-menu__item">
          <a href="{{ routes.collections_url }}/apparel" class="mobile-menu__link">Apparel</a>
        </li>
        <li class="mobile-menu__item">
          <a href="{{ routes.collections_url }}/accessories" class="mobile-menu__link">Accessories</a>
        </li>
        <li class="mobile-menu__item">
          <a href="{{ routes.collections_url }}/prints" class="mobile-menu__link">Prints</a>
        </li>
        <li class="mobile-menu__item">
          <a href="{{ routes.all_products_collection_url }}" class="mobile-menu__link">All</a>
        </li>
      {%- endif -%}
    </ul>
  </nav>
</div>

{%- comment -%} Inline script removed; logic now resides in assets/header.js {%- endcomment -%}

{% schema %}
{
  "name": "Header (TNO)",
  "settings": [
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Enable Sticky Header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show Account Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "transparent_header",
      "label": "Transparent header",
      "default": true
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main menu",
      "info": "Select the primary navigation menu"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu",
      "info": "Deprecated: use 'Main menu'. Left for backward compatibility."
    }
  ],
  "blocks": [
    {
      "type": "mega_menu",
      "name": "Mega Menu",
      "settings": [
        {
          "type": "text",
          "id": "title_match",
          "label": "Title to match (top-level nav)",
          "info": "Example: SHOP"
        },
        {
          "type": "link_list",
          "id": "col1",
          "label": "Column 1 links"
        },
        {
          "type": "text",
          "id": "col1_title",
          "label": "Column 1 title",
          "default": "// Shop by Category"
        },
        {
          "type": "link_list",
          "id": "col2",
          "label": "Column 2 links"
        },
        {
          "type": "text",
          "id": "col2_title",
          "label": "Column 2 title",
          "default": "// Shop by Style"
        },
        {
          "type": "link_list",
          "id": "col3",
          "label": "Column 3 links"
        },
        {
          "type": "text",
          "id": "col3_title",
          "label": "Column 3 title",
          "default": "// Drops"
        }
      ]
    }
  ],
  "enabled_on": {
    "groups": ["header"]
  }
}
{% endschema %}
