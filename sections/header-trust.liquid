{% comment %}
  TRUST.NO.OUTPUT — Header Section

  A minimalist cyberpunk-inspired header featuring:
  - Text logo with glitch hover effect
  - Centered navigation with color-shift hover
  - Icon-based utilities (Search, Account, Cart)
  - Sticky behavior with backdrop blur on scroll
  - Mobile-responsive with full-screen menu overlay
  - "Reality is under construction" tooltip on logo hover

  Philosophy: The header is a portal—not just navigation,
  but a digital interface that reveals its constructed nature
  through subtle glitches and fragmentations.
{% endcomment %}

<style>
  /* ========================================
     Header Base Styles
     ======================================== */

  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: transparent;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 1.5rem 2rem;
  }

  /* Scrolled state: Dark backdrop blur */
  .site-header.is-scrolled {
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 1px 0 rgba(0, 255, 255, 0.1);
    padding: 1rem 2rem;
  }

  .site-header__inner {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  /* ========================================
     Logo Area (Left)
     ======================================== */

  .header-logo {
    flex-shrink: 0;
    position: relative;
  }

  .header-logo__link {
    font-family: var(--font-mono, 'Space Mono', 'IBM Plex Mono', monospace);
    font-size: clamp(1rem, 2vw, 1.25rem);
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: #eaeaea;
    text-decoration: none;
    display: inline-block;
    position: relative;
    transition: color 0.3s ease;
  }

  /* Glitch effect on logo hover */
  .header-logo__link::before,
  .header-logo__link::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .header-logo__link::before {
    color: #00ffff;
    z-index: -1;
    clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
  }

  .header-logo__link::after {
    color: #ff00ff;
    z-index: -2;
    clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
  }

  .header-logo__link:hover::before,
  .header-logo__link:hover::after {
    opacity: 0.7;
    animation: glitch-logo 0.3s ease;
  }

  @keyframes glitch-logo {
    0%,
    100% {
      transform: translate(0, 0);
    }
    25% {
      transform: translate(-2px, 1px);
    }
    50% {
      transform: translate(2px, -1px);
    }
    75% {
      transform: translate(-1px, -1px);
    }
  }

  /* Tooltip: "Reality is under construction" */
  .header-logo__link[data-tooltip]:hover::before {
    content: attr(data-tooltip);
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(0, 0, 0, 0.95);
    border: 1px solid #00ffff;
    color: #00ffff;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    white-space: nowrap;
    opacity: 1;
    clip-path: none;
    z-index: 10;
    animation: none;
    pointer-events: none;
  }

  /* ========================================
     Navigation (Centered)
     ======================================== */

  .header-nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .header-nav__list {
    display: flex;
    gap: 2.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header-nav__item {
    position: relative;
  }

  .header-nav__link {
    font-family: var(--font-mono, monospace);
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #eaeaea;
    text-decoration: none;
    position: relative;
    transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-block;
  }

  /* Color shift hover: Cyan → Magenta */
  .header-nav__link:hover {
    color: #00ffff;
  }

  .header-nav__link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 1px;
    background: linear-gradient(90deg, #00ffff, #ff00ff);
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .header-nav__link:hover::after {
    width: 100%;
  }

  /* Active state */
  .header-nav__link.is-active {
    color: #00ffff;
  }

  .header-nav__link.is-active::after {
    width: 100%;
  }

  /* ========================================
     Icon Area (Right)
     ======================================== */

  .header-icons {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex-shrink: 0;
  }

  .header-icon {
    position: relative;
    width: 24px;
    height: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #eaeaea;
  }

  .header-icon:hover {
    color: #00ffff;
    transform: translateY(-2px);
  }

  .header-icon svg {
    width: 100%;
    height: 100%;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
  }

  /* Cart badge */
  .header-icon--cart {
    position: relative;
  }

  .cart-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    min-width: 18px;
    height: 18px;
    padding: 0 4px;
    background: #ff00ff;
    color: #000;
    font-family: var(--font-mono, monospace);
    font-size: 0.625rem;
    font-weight: 700;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
    animation: pulse-badge 2s ease-in-out infinite;
  }

  @keyframes pulse-badge {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
  }

  /* ========================================
     Mobile Menu Toggle
     ======================================== */

  .header-menu-toggle {
    display: none;
    flex-direction: column;
    gap: 5px;
    cursor: pointer;
    padding: 0.5rem;
    background: none;
    border: none;
  }

  .header-menu-toggle span {
    width: 24px;
    height: 2px;
    background: #eaeaea;
    transition: all 0.3s ease;
  }

  .header-menu-toggle:hover span {
    background: #00ffff;
  }

  .header-menu-toggle.is-active span:nth-child(1) {
    transform: rotate(45deg) translateY(7px);
  }

  .header-menu-toggle.is-active span:nth-child(2) {
    opacity: 0;
  }

  .header-menu-toggle.is-active span:nth-child(3) {
    transform: rotate(-45deg) translateY(-7px);
  }

  /* ========================================
     Mobile Menu Overlay
     ======================================== */

  .mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.98);
    backdrop-filter: blur(20px);
    z-index: 999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mobile-menu.is-active {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu__nav {
    list-style: none;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  .mobile-menu__item {
    margin: 2rem 0;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mobile-menu.is-active .mobile-menu__item {
    opacity: 1;
    transform: translateY(0);
  }

  .mobile-menu.is-active .mobile-menu__item:nth-child(1) {
    transition-delay: 0.1s;
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(2) {
    transition-delay: 0.2s;
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(3) {
    transition-delay: 0.3s;
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(4) {
    transition-delay: 0.4s;
  }

  .mobile-menu__link {
    font-family: var(--font-mono, monospace);
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #eaeaea;
    text-decoration: none;
    position: relative;
    display: inline-block;
    transition: color 0.3s ease;
  }

  .mobile-menu__link:hover {
    color: #00ffff;
  }

  /* ========================================
     Responsive Design
     ======================================== */

  @media (max-width: 1024px) {
    .header-nav__list {
      gap: 1.5rem;
    }

    .header-nav__link {
      font-size: 0.8rem;
    }
  }

  @media (max-width: 768px) {
    .site-header {
      padding: 1rem 1.5rem;
    }

    .site-header.is-scrolled {
      padding: 0.75rem 1.5rem;
    }

    .header-nav {
      display: none;
    }

    .header-menu-toggle {
      display: flex;
    }

    .header-icons {
      gap: 1rem;
    }

    .header-icon {
      width: 20px;
      height: 20px;
    }
  }

  /* ========================================
     Accessibility: Reduced Motion
     ======================================== */

  @media (prefers-reduced-motion: reduce) {
    .site-header,
    .header-logo__link,
    .header-nav__link,
    .header-icon,
    .mobile-menu,
    .mobile-menu__item {
      transition: none;
      animation: none;
    }

    .header-logo__link::before,
    .header-logo__link::after {
      display: none;
    }

    .cart-badge {
      animation: none;
    }
  }

  /* ========================================
     Optional: Scanline Effect
     ======================================== */

  .site-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent);
    animation: scanline-sweep 3s linear infinite;
    opacity: 0.5;
  }

  @keyframes scanline-sweep {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  /* ========================================
     Body Padding for Fixed Header
     ======================================== */

  body {
    padding-top: 80px;
  }

  @media (max-width: 768px) {
    body {
      padding-top: 60px;
    }
  }
</style>

<header class="site-header" id="site-header">
  <div class="site-header__inner">
    {%- comment %} Logo (Left) {%- endcomment %}
    <div class="header-logo">
      <a
        href="{{ routes.root_url }}"
        class="header-logo__link"
        data-text="TRUST.NO.OUTPUT"
        data-tooltip="Reality is under construction"
      >
        TRUST.NO.OUTPUT
      </a>
    </div>

    {%- comment %} Navigation (Center) {%- endcomment %}
    <nav class="header-nav" aria-label="Main Navigation">
      {%- assign menu_ref = linklists[section.settings.menu] -%}
      {%- if menu_ref.links and menu_ref.links.size > 0 -%}
        <ul class="header-nav__list">
          {% for link in menu_ref.links %}
            <li class="header-nav__item">
              <a
                href="{{ link.url }}"
                class="header-nav__link {% if link.active %}is-active{% endif %}"
              >
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      {%- else -%}
        {%- comment %}
          Fallback navigation shown when no menu is selected or it's empty.
          Uses core site destinations to ensure a working header out-of-the-box.
        {%- endcomment %}
        <ul class="header-nav__list">
          <li class="header-nav__item">
            <a href="{{ routes.all_products_collection_url }}" class="header-nav__link">Products</a>
          </li>
          <li class="header-nav__item">
            <a href="/blogs/news" class="header-nav__link">Blog</a>
          </li>
          <li class="header-nav__item">
            <a href="/pages/about" class="header-nav__link">About</a>
          </li>
          <li class="header-nav__item">
            <a href="/pages/contact" class="header-nav__link">Contact</a>
          </li>
        </ul>
      {%- endif -%}
    </nav>

    {%- comment %} Icons (Right) {%- endcomment %}
    <div class="header-icons">
      {%- comment %} Search Icon {%- endcomment %}
      {% if section.settings.show_search %}
        <button class="header-icon header-icon--search" aria-label="Search" id="search-toggle">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
        </button>
      {% endif %}

      {%- comment %} Account Icon {%- endcomment %}
      {% if section.settings.show_account %}
        <a href="{{ routes.account_url }}" class="header-icon header-icon--account" aria-label="Account">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </a>
      {% endif %}

      {%- comment %} Cart Icon with Badge {%- endcomment %}
      <a href="{{ routes.cart_url }}" class="header-icon header-icon--cart" aria-label="Cart">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <span class="cart-badge" id="cart-count">
          {{ cart.item_count }}
        </span>
      </a>

      {%- comment %} Mobile Menu Toggle {%- endcomment %}
      <button class="header-menu-toggle" aria-label="Menu" id="mobile-menu-toggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </div>
</header>

{%- comment %} Mobile Menu Overlay {%- endcomment %}
<div class="mobile-menu" id="mobile-menu">
  <nav class="mobile-menu__nav">
    {%- assign menu_ref = linklists[section.settings.menu] -%}
    <ul>
      {%- if menu_ref.links and menu_ref.links.size > 0 -%}
        {% for link in menu_ref.links %}
          <li class="mobile-menu__item">
            <a href="{{ link.url }}" class="mobile-menu__link">{{ link.title }}</a>
          </li>
        {% endfor %}
      {%- else -%}
        <li class="mobile-menu__item">
          <a href="{{ routes.all_products_collection_url }}" class="mobile-menu__link">Products</a>
        </li>
        <li class="mobile-menu__item">
          <a href="/blogs/news" class="mobile-menu__link">Blog</a>
        </li>
        <li class="mobile-menu__item">
          <a href="/pages/about" class="mobile-menu__link">About</a>
        </li>
        <li class="mobile-menu__item">
          <a href="/pages/contact" class="mobile-menu__link">Contact</a>
        </li>
      {%- endif -%}
    </ul>
  </nav>
</div>

<script>
  /**
   * TRUST.NO.OUTPUT — Header Interactions
   *
   * Features:
   * - Sticky header with scroll detection
   * - Mobile menu toggle with ESC key support
   * - Cart count update function
   * - Smooth transitions
   */

  (function () {
    'use strict';

    const header = document.getElementById('site-header');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    let lastScrollTop = 0;

    /**
     * Scroll Detection: Add 'is-scrolled' class after 50px
     */
    function handleScroll() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (scrollTop > 50) {
        header.classList.add('is-scrolled');
      } else {
        header.classList.remove('is-scrolled');
      }

      lastScrollTop = scrollTop;
    }

    window.addEventListener('scroll', handleScroll, { passive: true });

    /**
     * Mobile Menu Toggle
     */
    if (mobileMenuToggle && mobileMenu) {
      mobileMenuToggle.addEventListener('click', function () {
        const isActive = mobileMenu.classList.contains('is-active');

        if (isActive) {
          mobileMenu.classList.remove('is-active');
          mobileMenuToggle.classList.remove('is-active');
          document.body.style.overflow = '';
        } else {
          mobileMenu.classList.add('is-active');
          mobileMenuToggle.classList.add('is-active');
          document.body.style.overflow = 'hidden';
        }
      });

      // Close menu when clicking menu links
      const mobileLinks = mobileMenu.querySelectorAll('.mobile-menu__link');
      mobileLinks.forEach((link) => {
        link.addEventListener('click', function () {
          mobileMenu.classList.remove('is-active');
          mobileMenuToggle.classList.remove('is-active');
          document.body.style.overflow = '';
        });
      });

      // Close menu on ESC key
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && mobileMenu.classList.contains('is-active')) {
          mobileMenu.classList.remove('is-active');
          mobileMenuToggle.classList.remove('is-active');
          document.body.style.overflow = '';
        }
      });
    }

    /**
     * Cart Count Update
     * Call this function after adding items to cart
     */
    window.updateCartCount = function () {
      fetch('/cart.js')
        .then((response) => response.json())
        .then((cart) => {
          const cartCount = document.getElementById('cart-count');
          if (cartCount) {
            cartCount.textContent = cart.item_count;
          }
        })
        .catch((error) => {
          console.error('Error updating cart count:', error);
        });
    };
  })();
</script>

{% schema %}
{
  "name": "Header (TNO)",
  "settings": [
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Enable Sticky Header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show Account Icon",
      "default": true
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu",
      "info": "Select the navigation menu to display"
    }
  ],
  "enabled_on": {
    "groups": ["header"]
  }
}
{% endschema %}
