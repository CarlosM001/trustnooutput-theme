{%- liquid
  assign card_product = card_product | default: product
  if card_product == blank
    echo ''
    break
  endif

  assign featured_media = card_product.featured_media
  assign loading = 'eager'
  if lazy_load
    assign loading = 'lazy'
  endif
-%}

<div class="card-wrapper product-card-wrapper" data-product-id="{{ card_product.id }}">
  <div class="card card--product tno-card">
    <div class="card__inner">
      {%- comment -%}
        MEDIA
      {%- endcomment -%}
      <div class="card__media">
        <a
          href="{{ card_product.url }}"
          class="full-unstyled-link"
          aria-label="{{ card_product.title | escape }}"
        >
          {%- if featured_media -%}
            <div class="media">
              {{
                featured_media
                | image_url: width: 900
                | image_tag:
                  loading: loading,
                  sizes: '(min-width: 1200px) 20vw, (min-width: 750px) 33vw, 100vw',
                  alt: featured_media.alt
                | escape
              }}
            </div>
          {%- else -%}
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          {%- endif -%}
        </a>

        {%- comment -%}
          Badges: Sale / Sold out
        {%- endcomment -%}
        {%- if card_product.available == false
          or card_product.compare_at_price > card_product.price
        -%}
          <div class="card__badge">
            {%- if card_product.available == false -%}
              <span class="badge badge--sold-out">
                {{ 'products.product.sold_out' | t }}
              </span>
            {%- elsif card_product.compare_at_price > card_product.price -%}
              <span class="badge badge--sale">
                {{ 'products.product.on_sale' | t }}
              </span>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>

      {%- comment -%}
        CONTENT
      {%- endcomment -%}
      <div class="card__content">
        <div class="card__information">
          {%- if show_vendor -%}
            <span class="card__vendor">
              {{ card_product.vendor }}
            </span>
          {%- endif -%}

          <h3 class="card__heading">
            <a href="{{ card_product.url }}" class="full-unstyled-link">
              {{ card_product.title | escape }}
            </a>
          </h3>

          <div class="card__meta">
            {%- render 'price', product: card_product, price_class: 'price' -%}

            {%- if show_rating and card_product.metafields.reviews.rating.value != blank -%}
              <span
                class="tno-rating"
                aria-label="Product rating: {{ card_product.metafields.reviews.rating.value }}/5"
              >
                {% assign rating = card_product.metafields.reviews.rating.value | round: 1 %}
                {% for i in (1..5) %}
                  {% if i <= rating %}
                    <svg
                      class="tno-star tno-star--filled"
                      width="16"
                      height="16"
                      aria-hidden="true"
                      focusable="false"
                    >
                      <use xlink:href="#icon-star-filled"></use>
                    </svg>
                  {% else %}
                    <svg
                      class="tno-star tno-star--empty"
                      width="16"
                      height="16"
                      aria-hidden="true"
                      focusable="false"
                    >
                      <use xlink:href="#icon-star-empty"></use>
                    </svg>
                  {% endif %}
                {% endfor %}
              </span>
            {%- endif -%}
          </div>
        </div>

        {%- comment -%}
          QUICK ADD (optional – gesteuert über section.settings.quick_add)
        {%- endcomment -%}
        {%- if quick_add == 'standard' and card_product.available -%}
          <div class="card__actions">
            {% form 'product',
              card_product,
              class: 'form form--card',
              novalidate: 'novalidate',
              data-type: 'add-to-cart-form'
            %}
              <input
                type="hidden"
                name="id"
                value="{{ card_product.selected_or_first_available_variant.id }}"
              >

              <button
                type="submit"
                class="brand-button brand-button--primary brand-button--full"
              >
                <span>{{ 'products.product.add_to_cart' | t | upcase }}</span>
              </button>
            {% endform %}
          </div>
        {%- endif -%}

        {%- if quick_add == 'standard' and card_product.available == false -%}
          <div class="card__actions">
            <button
              type="button"
              class="brand-button brand-button--secondary brand-button--full"
              disabled
            >
              <span>{{ 'products.product.sold_out' | t | upcase }}</span>
            </button>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>
