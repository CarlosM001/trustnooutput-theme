{% comment %}
  TRUST.NO.OUTPUT — Header Section

  A minimalist cyberpunk-inspired header featuring:
  - Text logo with glitch hover effect
  - Centered navigation with color-shift hover
  - Icon-based utilities (Search, Account, Cart)
  - Sticky behavior with backdrop blur on scroll
  - Mobile-responsive with full-screen menu overlay
  - "Reality is under construction" tooltip on logo hover

  Philosophy: The header is a portal—not just navigation,
  but a digital interface that reveals its constructed nature
  through subtle glitches and fragmentations.
{% endcomment %}
{%- comment -%} Header JS moved to assets/header.js for cacheability. {%- endcomment -%}
<style>
  /* ========================================
     Header Base Styles
     ======================================== */

  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    /* Background handled by global CSS (.header--tno / .tno-header) and transparency setting */
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 1.5rem 2rem;
    border: none;
    box-shadow: none;
  }

  /* Scrolled state: Dark backdrop blur */
  .site-header.is-scrolled {
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: none;
    border: none;
    padding: 1rem 2rem;
  }

  /* Mobile: compact header */
  @media (max-width: 768px) {
    .site-header {
      padding: 0;
      background: var(--color-body-bg, #0a0a0a);
      border: none;
      box-shadow: none;
    }
    .site-header.is-scrolled {
      padding: 0;
      background: rgba(10, 10, 10, 0.95);
      box-shadow: none;
      border-bottom: none;
    }

    /* Mobile: Two-row layout container */
    .site-header__inner {
      flex-direction: column;
      gap: 0;
      padding: 0;
    }

    /* Mobile Row 1: Top bar (burger + logo + icons) */
    .tno-header__topbar {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1rem;
      min-height: 60px;
      gap: 0.75rem;
      background: var(--color-body-bg, #0a0a0a);
    }

    /* Mobile: Burger button (left) */
    .tno-header__burger {
      order: -1;
      position: static;
      margin-right: 0;
      flex-shrink: 0;
    }

    /* Mobile: Logo (center) */
    .tno-header__logo {
      flex: 1;
      text-align: center;
      margin: 0;
      padding: 0 0.5rem;
    }

    .tno-header__logo .header-logo__link {
      font-size: 0.9375rem;
      letter-spacing: 0.08em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-block;
      max-width: 100%;
    }

    /* Mobile: Icon group (right) - Account + Cart only */
    .tno-header__icons {
      display: flex !important;
      gap: 0.5rem;
      margin: 0;
      flex-shrink: 0;
    }

    /* Mobile: Hide search icon from topbar (search bar below is sufficient) */
    .tno-header__icons .header-icon--search {
      display: none !important;
    }

    .tno-header__icon {
      width: 20px;
      height: 20px;
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .tno-header__icon svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }

    /* Mobile Row 2: Search bar */
    .tno-header__search-mobile {
      width: 100%;
      padding: 0 1rem 1rem 1rem;
      display: block;
      background: var(--color-body-bg, #0a0a0a);
    }

    .tno-header__search-form {
      width: 100%;
      max-width: 100%;
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 0.625rem 1rem;
      gap: 0.5rem;
      transition: all 0.2s ease;
      height: 44px;
    }

    .tno-header__search-form:focus-within {
      background: rgba(255, 255, 255, 0.09);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.1);
    }

    .tno-header__search-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: #fff;
      font-family: var(--font-mono, monospace);
      font-size: 0.875rem;
      padding: 0;
      line-height: 1.4;
      min-width: 0;
    }

    .tno-header__search-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .tno-header__search-button {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      width: 20px;
      height: 20px;
      padding: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
      flex-shrink: 0;
    }

    .tno-header__search-button:hover,
    .tno-header__search-button:focus {
      color: #00ffff;
    }

    .tno-header__search-button svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }

    /* Hide desktop navigation and desktop search on mobile */
    .header-nav,
    .tno-nav,
    .tno-header__desktop-utility {
      display: none !important;
    }
  }

  .site-header__inner {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;

    /* Desktop: hide mobile-specific elements */
    @media (min-width: 769px) {
      .tno-header__topbar {
        display: contents;
      }

      .tno-header__search-mobile {
        display: none;
      }

      .tno-header__burger {
        display: none;
      }

      .tno-header__icons {
        display: none;
      }
    }
  }

  /* ========================================
     Logo Area (Left)
     ======================================== */

  .header-logo {
    flex-shrink: 0;
    position: relative;
  }

  .header-logo__link {
    font-family: var(--font-mono, 'Space Mono', 'IBM Plex Mono', monospace);
    font-size: clamp(0.875rem, 2vw, 1.25rem);
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: #eaeaea;
    text-decoration: none;
    display: inline-block;
    position: relative;
    transition: color 0.3s ease;
  }

  @media (max-width: 768px) {
    .header-logo__link {
      font-size: 0.875rem;
      letter-spacing: 0.03em;
    }
  }

  /* Glitch effect on logo hover */
  .header-logo__link::before,
  .header-logo__link::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .header-logo__link::before {
    color: #00ffff;
    z-index: -1;
    clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
  }

  .header-logo__link::after {
    color: #ff00ff;
    z-index: -2;
    clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
  }

  .header-logo__link:hover::before,
  .header-logo__link:hover::after {
    opacity: 0.7;
    animation: glitch-logo 0.3s ease;
  }

  @keyframes glitch-logo {
    0%,
    100% {
      transform: translate(0, 0);
    }
    25% {
      transform: translate(-2px, 1px);
    }
    50% {
      transform: translate(2px, -1px);
    }
    75% {
      transform: translate(-1px, -1px);
    }
  }

  /* Tooltip: "Reality is under construction" */
  .header-logo__link[data-tooltip]:hover::before {
    content: attr(data-tooltip);
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(0, 0, 0, 0.95);
    border: 1px solid #00ffff;
    color: #00ffff;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    white-space: nowrap;
    opacity: 1;
    clip-path: none;
    z-index: 10;
    animation: none;
    pointer-events: none;
  }

  /* ========================================
     Navigation (Centered)
     ======================================== */

  .header-nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }
  .header-nav__list {
    display: flex;
    gap: 2.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .header-nav__item {
    position: relative;
  }
  .header-nav__link {
    font-family: var(--font-mono, monospace);
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #eaeaea;
    text-decoration: none;
    position: relative;
    transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-block;
  }

  .header-nav__link:hover {
    color: #00ffff;
  }
  .header-nav__link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 1px;
    background: linear-gradient(90deg, #00ffff, #ff00ff);
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .header-nav__link:hover::after {
    width: 100%;
  }
  .header-nav__link.is-active {
    color: #00ffff;
  }
  .header-nav__link.is-active::after {
    width: 100%;
  }

  /* ========================================
     Icon Area (Right)
     ======================================== */
  .header-icons {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex-shrink: 0;
  }
  .header-icon {
    position: relative;
    width: 24px;
    height: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #eaeaea;
    min-width: 40px;
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @media (max-width: 768px) {
    .header-icons {
      gap: 0.5rem;
    }
    .header-icon {
      width: 20px;
      height: 20px;
    }
    /* Hide full search bar on mobile */
    .tno-search {
      display: none;
    }
    /* Show search icon button instead */
    .header-icon--search {
      display: flex;
    }
  }
  .header-icon:hover {
    color: #00ffff;
    transform: translateY(-2px);
  }
  .header-icon svg {
    width: 100%;
    height: 100%;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
  }
  .header-icon--cart {
    position: relative;
  }
  .cart-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    min-width: 18px;
    height: 18px;
    padding: 0 4px;
    background: #ff00ff;
    color: #000;
    font-family: var(--font-mono, monospace);
    font-size: 0.625rem;
    font-weight: 700;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
    animation: pulse-badge 2s ease-in-out infinite;
  }
  @keyframes pulse-badge {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
  }

  /* ======================================== Mobile Menu Toggle */
  .header-menu-toggle {
    display: none;
    cursor: pointer;
    padding: 0.5rem;
    background: none;
    border: none;
    width: 32px;
    height: 28px;
    position: relative;
    z-index: 1001;
  }
  .header-menu-toggle span {
    width: 24px;
    height: 2px;
    background: #eaeaea;
    transition: all 0.3s ease;
  }
  .header-menu-toggle:hover span {
    background: #00ffff;
  }
  .header-menu-toggle.is-active span:nth-child(1) {
    transform: rotate(45deg) translateY(7px);
  }
  .header-menu-toggle.is-active span:nth-child(2) {
    opacity: 0;
  }
  .header-menu-toggle.is-active span:nth-child(3) {
    transform: rotate(-45deg) translateY(-7px);
  }

  /* ======================================== Mobile Menu Overlay */
  .mobile-menu {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.98);
    backdrop-filter: blur(20px);
    z-index: 999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .mobile-menu.is-active {
    opacity: 1;
    visibility: visible;
  }
  .mobile-menu__nav {
    list-style: none;
    margin: 0;
    padding: 0;
    text-align: center;
  }
  .mobile-menu__item {
    margin: 2rem 0;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .mobile-menu.is-active .mobile-menu__item {
    opacity: 1;
    transform: translateY(0);
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(1) {
    transition-delay: 0.1s;
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(2) {
    transition-delay: 0.2s;
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(3) {
    transition-delay: 0.3s;
  }
  .mobile-menu.is-active .mobile-menu__item:nth-child(4) {
    transition-delay: 0.4s;
  }
  .mobile-menu__link {
    font-family: var(--font-mono, monospace);
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #eaeaea;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  .mobile-menu__link:hover {
    color: #00ffff;
  }

  /* ======================================== Responsive */
  @media (max-width: 1024px) {
    .header-nav__list {
      gap: 1.5rem;
    }
    .header-nav__link {
      font-size: 0.8rem;
    }
  }
  @media (max-width: 768px) {
    .header-nav {
      display: none;
    }
    .header-menu-toggle {
      display: flex !important;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
    }
  }

  /* ======================================== Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .site-header,
    .header-logo__link,
    .header-nav__link,
    .header-icon,
    .mobile-menu,
    .mobile-menu__item {
      transition: none;
      animation: none;
    }
    .header-logo__link::before,
    .header-logo__link::after {
      display: none;
    }
    .cart-badge {
      animation: none;
    }
  }

  /* ======================================== Optional Scanline (Disabled on mobile) */
  .site-header::before {
    display: none;
  }

  /* ======================================== Body Padding */
  body {
    padding-top: 80px;
  }
  @media (max-width: 768px) {
    body {
      padding-top: 120px;
    }
  }
</style>

{%- liquid
  assign is_manifesto = false
  if template.name == 'page' and template.suffix == 'manifesto'
    assign is_manifesto = true
  endif
  assign show_transparent = section.settings.transparent_header
  if is_manifesto
    assign show_transparent = false
  endif
-%}

<header
  class="site-header tno-header header--tno {% if show_transparent %}is-transparent{% endif %}"
  id="site-header"
>
  <div class="site-header__inner tno-header__container">
    {%- comment %} Mobile Top Bar (Row 1: Burger + Logo + Icons) {%- endcomment %}
    <div class="tno-header__topbar">
      {%- comment %} Mobile Menu Toggle (Left on Mobile) {%- endcomment %}
      <button
        class="header-menu-toggle tno-header__burger"
        aria-label="Menu"
        id="mobile-menu-toggle"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>

      {%- comment %} Logo (Left) {%- endcomment %}
      <div class="header-logo tno-header__logo">
        <a
          href="{{ routes.root_url }}"
          class="header-logo__link"
          data-text="TRUST.NO.OUTPUT"
          data-tooltip="Reality is under construction"
        >
          TRUST.NO.OUTPUT
        </a>
      </div>

      {%- comment %} Icons (Right: Account + Cart only on Mobile) {%- endcomment %}
      <div class="header-icons tno-nav__utility tno-header__icons">
        {%- comment %} Account Icon {%- endcomment %}
        {% if section.settings.show_account %}
          <a
            href="{{ routes.account_url }}"
            class="header-icon header-icon--account tno-header__icon"
            aria-label="Account"
          >
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </a>
        {% endif %}

        {%- comment %} Cart Icon with Badge {%- endcomment %}
        <a
          href="{{ routes.cart_url }}"
          class="header-icon header-icon--cart tno-ico tno-header__icon"
          aria-label="Cart"
        >
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          <span class="cart-badge tno-badge" id="cart-count">
            {{ cart.item_count }}
          </span>
        </a>
      </div>
    </div>

    {%- comment %} Desktop Navigation (Center) - Hidden on Mobile {%- endcomment %}
    <nav class="header-nav tno-nav" role="navigation" aria-label="Main">
      {%- assign menu_handle = section.settings.main_menu | default: section.settings.menu -%}
      {%- assign menu_ref = linklists[menu_handle] -%}
      {%- if menu_ref.links and menu_ref.links.size > 0 -%}
        <ul class="header-nav__list tno-nav__list">
          {% for link in menu_ref.links %}
            {%- assign has_mega = false -%}
            {%- assign mega_block = null -%}
            {%- for block in section.blocks -%}
              {%- if block.type == 'mega_menu' -%}
                {%- assign block_title = block.settings.title_match | strip | downcase -%}
                {%- assign link_title_down = link.title | strip | downcase -%}
                {%- if block_title != blank and block_title == link_title_down -%}
                  {%- assign has_mega = true -%}
                  {%- assign mega_block = block -%}
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
            <li class="header-nav__item tno-nav__item {% if has_mega %}tno-has-mega{% elsif link.links.size > 0 %}tno-has-dropdown{% endif %}">
              <a
                href="{{ link.url }}"
                class="header-nav__link tno-nav__link {% if link.active %}is-active{% endif %}"
              >
                {{ link.title }}
              </a>
              {%- if has_mega and mega_block -%}
                <button
                  class="tno-nav__toggle"
                  aria-expanded="false"
                  aria-controls="mega-{{ forloop.index }}-{{ section.id }}"
                  aria-label="Toggle {{ link.title }} menu"
                ></button>
                <div
                  class="tno-mega"
                  id="mega-{{ forloop.index }}-{{ section.id }}"
                  data-panel="mega"
                  tabindex="-1"
                >
                  <div class="tno-mega__col">
                    <p class="tno-mega__title">
                      {{ mega_block.settings.col1_title | default: '// Shop by Category' }}
                    </p>
                    {%- assign col1_list = linklists[mega_block.settings.col1] -%}
                    {%- if col1_list and col1_list.links and col1_list.links.size > 0 -%}
                      <ul class="tno-mega__list">
                        {%- for l in col1_list.links -%}
                          <li>
                            <a class="tno-mega__link" href="{{ l.url }}">{{ l.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                  <div class="tno-mega__col">
                    <p class="tno-mega__title">
                      {{ mega_block.settings.col2_title | default: '// Shop by Style' }}
                    </p>
                    {%- assign col2_list = linklists[mega_block.settings.col2] -%}
                    {%- if col2_list and col2_list.links and col2_list.links.size > 0 -%}
                      <ul class="tno-mega__list">
                        {%- for l in col2_list.links -%}
                          <li>
                            <a class="tno-mega__link" href="{{ l.url }}">{{ l.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                  <div class="tno-mega__col">
                    <p class="tno-mega__title">
                      {{ mega_block.settings.col3_title | default: '// Drops' }}
                    </p>
                    {%- assign col3_list = linklists[mega_block.settings.col3] -%}
                    {%- if col3_list and col3_list.links and col3_list.links.size > 0 -%}
                      <ul class="tno-mega__list">
                        {%- for l in col3_list.links -%}
                          <li>
                            <a class="tno-mega__link" href="{{ l.url }}">{{ l.title }}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                </div>
              {%- elsif link.links and link.links.size > 0 -%}
                <button
                  class="tno-nav__toggle"
                  aria-expanded="false"
                  aria-controls="dropdown-{{ forloop.index }}-{{ section.id }}"
                  aria-label="Toggle {{ link.title }} menu"
                ></button>
                <div
                  class="tno-dropdown"
                  id="dropdown-{{ forloop.index }}-{{ section.id }}"
                  data-panel="dropdown"
                >
                  <ul class="tno-dropdown__list">
                    {%- for child in link.links -%}
                      <li class="tno-dropdown__item">
                        <a class="tno-dropdown__link" href="{{ child.url }}">{{ child.title }}</a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              {%- endif -%}
            </li>
          {% endfor %}
        </ul>
      {%- else -%}
        {%- comment %}
          Fallback navigation: Product-Type Collections
          APPAREL | ACCESSORIES | PRINTS | ALL
        {%- endcomment %}
        <ul class="header-nav__list tno-nav__list">
          <li class="header-nav__item tno-nav__item">
            <a href="{{ routes.collections_url }}/apparel" class="header-nav__link tno-nav__link"
              >Apparel</a
            >
          </li>
          <li class="header-nav__item tno-nav__item">
            <a
              href="{{ routes.collections_url }}/accessories"
              class="header-nav__link tno-nav__link"
              >Accessories</a
            >
          </li>
          <li class="header-nav__item tno-nav__item">
            <a href="{{ routes.collections_url }}/prints" class="header-nav__link tno-nav__link"
              >Prints</a
            >
          </li>
          <li class="header-nav__item tno-nav__item">
            <a
              href="{{ routes.all_products_collection_url }}"
              class="header-nav__link tno-nav__link"
              >All</a
            >
          </li>
        </ul>
      {%- endif -%}
    </nav>

    {%- comment %} Desktop Search & Icons (Right) - Hidden on Mobile {%- endcomment %}
    <div class="header-icons tno-nav__utility tno-header__desktop-utility">
      {%- comment %} Search Field (Desktop) {%- endcomment %}
      {% if section.settings.show_search %}
        <div class="tno-search">
          <form action="{{ routes.search_url }}" method="get" role="search">
            <input
              type="search"
              name="q"
              placeholder="Search..."
              class="tno-search__input"
              aria-label="Search"
            >
            <button type="submit" class="tno-search__button" aria-label="Submit search">⌕</button>
          </form>
        </div>
      {% endif %}

      {%- comment %} Account Icon {%- endcomment %}
      {% if section.settings.show_account %}
        <a
          href="{{ routes.account_url }}"
          class="header-icon header-icon--account"
          aria-label="Account"
        >
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </a>
      {% endif %}

      {%- comment %} Cart Icon with Badge {%- endcomment %}
      <a
        href="{{ routes.cart_url }}"
        class="header-icon header-icon--cart"
        aria-label="Cart"
      >
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <span class="cart-badge" id="cart-count-desktop">
          {{ cart.item_count }}
        </span>
      </a>
    </div>

    {%- comment %} Mobile Search Bar (Row 2) - Full width below top bar {%- endcomment %}
    {% if section.settings.show_search %}
      <div class="tno-header__search-mobile">
        <form
          action="{{ routes.search_url }}"
          method="get"
          role="search"
          class="tno-header__search-form"
        >
          <input
            type="search"
            name="q"
            placeholder="Search…"
            class="tno-header__search-input"
            aria-label="Search products"
          >
          <button type="submit" class="tno-header__search-button" aria-label="Submit search">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
          </button>
        </form>
      </div>
    {% endif %}
  </div>
</header>

{%- comment %} Mobile Menu Overlay – TNO header nav restructure {%- endcomment %}
<div
  class="mobile-menu"
  id="mobile-menu"
  role="dialog"
  aria-modal="true"
  aria-label="Main menu"
  aria-hidden="true"
  tabindex="-1"
>
  <nav class="mobile-menu__nav">
    {%- comment %} Use same menu as desktop for consistency {%- endcomment %}
    {%- assign mobile_menu_handle = section.settings.main_menu | default: section.settings.menu -%}
    {%- assign mobile_menu_ref = linklists[mobile_menu_handle] -%}
    <ul>
      {%- if mobile_menu_ref.links and mobile_menu_ref.links.size > 0 -%}
        {% for link in mobile_menu_ref.links %}
          <li class="mobile-menu__item">
            {%- comment %} TNO: Normalized structure - ALL items use .mobile-menu__row {%- endcomment %}
            <div class="mobile-menu__row">
              <a href="{{ link.url }}" class="mobile-menu__link">{{ link.title }}</a>
              {%- if link.links and link.links.size > 0 -%}
                <button
                  class="mobile-menu__toggle"
                  aria-expanded="false"
                  aria-controls="mobile-submenu-{{ forloop.index }}"
                  aria-label="Toggle {{ link.title }} submenu"
                  onclick="this.setAttribute('aria-expanded', this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true'); document.getElementById('mobile-submenu-{{ forloop.index }}').toggleAttribute('hidden');"
                >
                  <span class="mobile-menu__chevron">▾</span>
                </button>
              {%- endif -%}
            </div>
            {%- if link.links and link.links.size > 0 -%}
              <ul class="mobile-submenu" id="mobile-submenu-{{ forloop.index }}" hidden>
                {%- for child in link.links -%}
                  <li>
                    <a href="{{ child.url }}" class="mobile-submenu__link">{{ child.title }}</a>
                  </li>
                {%- endfor -%}
              </ul>
            {%- endif -%}
          </li>
        {% endfor %}
      {%- else -%}
        {%- comment %} Fallback: Basic product-type structure {%- endcomment %}
        <li class="mobile-menu__item">
          <a href="{{ routes.all_products_collection_url }}" class="mobile-menu__link">SHOP ALL</a>
        </li>
        <li class="mobile-menu__item">
          <a href="{{ routes.collections_url }}/apparel" class="mobile-menu__link">APPAREL</a>
        </li>
        <li class="mobile-menu__item">
          <a href="{{ routes.collections_url }}/accessories" class="mobile-menu__link"
            >ACCESSORIES</a
          >
        </li>
        <li class="mobile-menu__item">
          <a href="{{ routes.collections_url }}" class="mobile-menu__link">COLLECTIONS</a>
        </li>
      {%- endif -%}
    </ul>
  </nav>
</div>

{%- comment -%} Inline script removed; logic now resides in assets/header.js {%- endcomment -%}

{% schema %}
{
  "name": "Header (TNO)",
  "settings": [
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Enable Sticky Header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show Account Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "transparent_header",
      "label": "Transparent header",
      "default": true
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main menu",
      "info": "Select the primary navigation menu"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu",
      "info": "Deprecated: use 'Main menu'. Left for backward compatibility."
    }
  ],
  "blocks": [
    {
      "type": "mega_menu",
      "name": "Mega Menu",
      "settings": [
        {
          "type": "text",
          "id": "title_match",
          "label": "Title to match (top-level nav)",
          "info": "Example: SHOP"
        },
        {
          "type": "link_list",
          "id": "col1",
          "label": "Column 1 links"
        },
        {
          "type": "text",
          "id": "col1_title",
          "label": "Column 1 title",
          "default": "// Shop by Category"
        },
        {
          "type": "link_list",
          "id": "col2",
          "label": "Column 2 links"
        },
        {
          "type": "text",
          "id": "col2_title",
          "label": "Column 2 title",
          "default": "// Shop by Style"
        },
        {
          "type": "link_list",
          "id": "col3",
          "label": "Column 3 links"
        },
        {
          "type": "text",
          "id": "col3_title",
          "label": "Column 3 title",
          "default": "// Drops"
        }
      ]
    }
  ],
  "enabled_on": {
    "groups": ["header"]
  }
}
{% endschema %}
