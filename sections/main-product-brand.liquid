{% comment %}
  BRAND-NEUTRAL CYBER-TECH PRODUCT SECTION V2 (POLISH PASS)

  Architecture:
  - Desktop: 2-column grid (media left ~55%, info right ~45%)
  - Mobile: Single column with sticky CTA
  - Premium cyber-tech streetwear aesthetic
  - Typography hierarchy: H1 → H2 → eyebrow → body
  - Metafield-driven with smart fallbacks
  - Brand-neutral class naming: .brand-product__*
  - Accessible, semantic HTML, WCAG 2.1 AA

  Version: 2.0
  Last updated: 2024-06-13
{% endcomment %}
<section
  id="MainProduct-{{ section.id }}"
  class="product-main-trust brand-product section-{{ section.id }}-padding"
  data-section="{{ section.id }}"
  data-product-id="{{ product.id }}"
>
  {%- comment -%} Core Stylesheets {%- endcomment -%}
  {{ 'component-price.css' | asset_url | stylesheet_tag }}
  {{ 'component-accordion.css' | asset_url | stylesheet_tag }}
  {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch.css' | asset_url | stylesheet_tag }}

  {%- comment -%} Section Padding {%- endcomment -%}
  {%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    }

    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }
  {%- endstyle -%}

  {%- comment -%} Core Scripts {%- endcomment -%}
  <script src="{{ 'product-info.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

  {%- assign product_form_id = 'product-form-' | append: section.id -%}

  {%- comment -%} Mobile Back Navigation Bar {%- endcomment -%}
  {%- assign back_collection = product.collections.first -%}
  <nav class="brand-mobile-back-bar" role="navigation" aria-label="Breadcrumb">
    <a
      class="brand-mobile-back-bar__link"
      href="{% if back_collection %}{{ back_collection.url }}{% else %}/collections/all{% endif %}"
      aria-label="{% if back_collection %}Back to {{ back_collection.title }}{% else %}Back to products{% endif %}"
    >
      <span class="brand-mobile-back-bar__icon" aria-hidden="true">←</span>
      <span class="brand-mobile-back-bar__label">
        {% if back_collection %}
          Back to {{ back_collection.title }}
        {% else %}
          Back to products
        {% endif %}
      </span>
    </a>
  </nav>

  {%- comment -%} TRUST Layout Wrapper {%- endcomment -%}
  <div class="product-main-trust__container">
    <div class="product-main-trust__layout">
        {%- comment -%} ========== LEFT COLUMN: MEDIA ========== {%- endcomment -%}
        <div class="product-main-trust__gallery brand-product__media-column">
        {%- comment -%} Main Featured Media {%- endcomment -%}
        <div class="brand-product__media-main" id="BrandMediaMain-{{ section.id }}">
          {%- comment -%} Label System corner hook (no content; styling via CSS) {%- endcomment -%}
          <div class="label-system label-tech label-corner" aria-hidden="true"></div>
          {%- if product.featured_media -%}
            <img
              src="{{ product.featured_media | image_url: width: 1200 }}"
              alt="{{ product.featured_media.alt | escape }}"
              class="brand-product__main-image"
              width="{{ product.featured_media.width }}"
              height="{{ product.featured_media.height }}"
              loading="eager"
            >
          {%- else -%}
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          {%- endif -%}
        </div>

        {%- comment -%} Thumbnail Gallery {%- endcomment -%}
        {%- if product.media.size > 1 -%}
          <div class="brand-product__thumbs">
            {%- for media in product.media limit: 6 -%}
              <button
                type="button"
                class="brand-product__thumb-button{% if forloop.first %} is-active{% endif %}"
                data-media-id="{{ media.id }}"
                data-media-position="{{ forloop.index }}"
                aria-label="View media {{ forloop.index }}"
              >
                {%- if media.media_type == 'image' -%}
                  <img
                    src="{{ media | image_url: width: 200 }}"
                    alt="{{ media.alt | escape }}"
                    width="100"
                    height="100"
                    loading="lazy"
                  >
                {%- elsif media.media_type == 'video' -%}
                  <img
                    src="{{ media.preview_image | image_url: width: 200 }}"
                    alt="{{ media.alt | escape }}"
                    width="100"
                    height="100"
                    loading="lazy"
                  >
                  <span class="brand-product__thumb-play-icon" aria-hidden="true">▶</span>
                {%- endif -%}
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}
        </div>

        {%- comment -%} ========== RIGHT COLUMN: INFO ========== {%- endcomment -%}
        <div class="product-main-trust__info brand-product__info-column">
        {%- comment -%} Eyebrow: Badges {%- endcomment -%}
        <div class="brand-product__eyebrow">
          <span class="brand-badge brand-badge--primary">{{ product.vendor | escape }}</span>
          {%- if product.tags contains 'limited-drop' -%}
            <span class="brand-badge brand-badge--accent">LIMITED DROP</span>
          {%- endif -%}
        </div>

        {%- comment -%} Product Title (H1) {%- endcomment -%}
        <h1 class="product-main-trust__title brand-product__title">{{ product.title | escape }}</h1>

        {%- comment -%} Price Block {%- endcomment -%}
        <div class="product-main-trust__price brand-product__price-block">
          {% render 'price', product: product, use_variant: true, show_badges: true %}
        </div>

        {%- comment -%} Shipping Meta Row {%- endcomment -%}
        <div class="product-main-trust__meta brand-product__shipping-meta">
          <span>Worldwide shipping</span>
          <span class="brand-dot" aria-hidden="true">•</span>
          <span>14-day returns</span>
        </div>

        {%- comment -%} Product Form {%- endcomment -%}
        <product-form class="brand-product__form">
          {%- form 'product', product, id: product_form_id, novalidate: 'novalidate' -%}
            <input
              type="hidden"
              name="id"
              value="{{ product.selected_or_first_available_variant.id }}"
              class="product-variant-id"
              {% unless product.selected_or_first_available_variant.available %}
                disabled
              {% endunless %}
            >

            {%- comment -%} Variant Picker: Chip/Pill Style {%- endcomment -%}
            {%- unless product.has_only_default_variant -%}
              <div class="product-main-trust__variants brand-product__variants">
                {% render 'product-variant-picker',
                  product: product,
                  block: section.blocks[0],
                  product_form_id: product_form_id,
                  force_pills: true
                %}
              </div>
            {%- endunless -%}

            {%- comment -%} CTA Container (can be sticky on mobile) {%- endcomment -%}
            <div class="product-main-trust__purchase brand-product__cta-container tno-product-actions">
              {%- comment -%} Primary CTA: Add to Cart {%- endcomment -%}
              <div class="brand-product__cta-row">
                <button
                  type="submit"
                  name="add"
                  class="product-main-trust__add-to-cart tno-button-primary brand-button brand-button--primary brand-button--full"
                  {% unless product.selected_or_first_available_variant.available %}
                    disabled
                  {% endunless %}
                >
                  <span>
                    {%- if product.selected_or_first_available_variant.available == false -%}
                      SOLD OUT
                    {%- else -%}
                      ADD TO CART
                    {%- endif -%}
                  </span>
                </button>
              </div>

              {%- comment -%} Express Checkout Buttons {%- endcomment -%}
              {%- if section.settings.show_dynamic_checkout -%}
                <div class="product-main-trust__express-checkout brand-product__express-checkout">
                  {{ form | payment_button }}
                </div>
              {%- endif -%}

              {%- comment -%} Trust Icons Row {%- endcomment -%}
              {% render 'product-trust-icons' %}
            </div>
          {%- endform -%}
        </product-form>

        {%- comment -%} Trust Row {%- endcomment -%}
        <div class="brand-product__trust-row" aria-label="Trust badges">
          <div class="brand-trust-badge">
            <svg
              class="brand-trust-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            <span>Secure checkout</span>
          </div>
          <div class="brand-trust-badge">
            <svg
              class="brand-trust-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <span>Encrypted payment</span>
          </div>
        </div>

        {%- comment -%} Key Points (from metafield) {%- endcomment -%}
        {%- if product.metafields.custom.key_points.value != blank -%}
          {%- assign key_points = product.metafields.custom.key_points.value | split: '|' -%}
          <ul class="brand-product__key-points">
            {%- for point in key_points -%}
              {%- if point != blank %}
                <li>{{ point | strip | escape }}</li>
              {%- endif %}
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- comment -%} Collapsible Accordions {%- endcomment -%}
        <div class="brand-product__accordions" role="region" aria-label="Product Details">
          {%- comment -%} Details / Description {%- endcomment -%}
          {%- if product.description != blank -%}
            <details class="brand-accordion" open>
              <summary class="brand-accordion__summary">
                <span>DETAILS</span>
                <svg class="brand-accordion__icon" width="12" height="12" viewBox="0 0 12 12" aria-hidden="true">
                  <path d="M6 1v10M1 6h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </summary>
              <div class="brand-accordion__content">
                {{ product.description }}
              </div>
            </details>
          {%- endif -%}

          {%- comment -%} Material & Care {%- endcomment -%}
          <details class="brand-accordion">
            <summary class="brand-accordion__summary">
              <span>MATERIAL &amp; CARE</span>
              <svg class="brand-accordion__icon" width="12" height="12" viewBox="0 0 12 12" aria-hidden="true">
                <path d="M6 1v10M1 6h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </summary>
            <div class="brand-accordion__content">
              {%- if product.metafields.custom.material.value != blank -%}
                <p>
                  <strong>Material:</strong> {{ product.metafields.custom.material.value | escape }}
                </p>
              {%- endif -%}
              {%- if product.metafields.custom.care_instructions.value != blank -%}
                <p>
                  <strong>Care:</strong>
                  {{ product.metafields.custom.care_instructions.value | escape }}
                </p>
              {%- else -%}
                <p>Machine wash cold. Tumble dry low. Do not iron on print.</p>
              {%- endif -%}
            </div>
          </details>

          {%- comment -%} Shipping & Returns {%- endcomment -%}
          <details class="brand-accordion">
            <summary class="brand-accordion__summary">
              <span>SHIPPING &amp; RETURNS</span>
              <svg class="brand-accordion__icon" width="12" height="12" viewBox="0 0 12 12" aria-hidden="true">
                <path d="M6 1v10M1 6h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </summary>
            <div class="brand-accordion__content">
              {%- if product.metafields.custom.shipping_info.value != blank -%}
                {{ product.metafields.custom.shipping_info.value }}
              {%- else -%}
                <p>Free worldwide shipping on orders over $100.</p>
                <p>Standard delivery: 5-7 business days.</p>
                <p>Express delivery: 2-3 business days.</p>
                <p>14-day return policy. Items must be unworn and in original condition.</p>
              {%- endif -%}
            </div>
          </details>
        </div>
        </div>
      </div>
    </div>

    {%- comment -%} ========== BELOW THE FOLD: STORY / SPEC / REVIEWS ========== {%- endcomment -%}
    <div class="brand-product__details">
      <div class="product-main-trust__meta-grid">
        {%- comment -%} 1. PRODUCT STORY (subtitle metafield or description fallback) {%- endcomment -%}
        {%- if section.settings.show_story_section -%}
          {%- liquid
            assign story_content = product.metafields.custom.subtitle.value
            if story_content == blank
              assign story_content = product.description
            endif
          -%}
          {%- if story_content != blank -%}
            <div class="product-main-trust__meta-card product-main-trust__meta-card--story">
              <header class="product-main-trust__meta-header">
                <h2
                  id="brand-product-story-heading"
                  class="product-main-trust__meta-title brand-details__heading brand-section-heading label-system label-tech"
                >
                  PRODUCT.STORY
                </h2>
              </header>
              <div class="product-main-trust__meta-body">
                <section class="brand-details__section" aria-labelledby="brand-product-story-heading">
                  <div class="brand-details__content">
                    {{ story_content }}
                  </div>
                </section>
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- comment -%} 2. SPECIFICATIONS (proper 2-column grid) {%- endcomment -%}
        {%- if section.settings.show_specs_section -%}
          {%- liquid
            assign has_material = false
            assign has_fit = false
            assign has_print = false
            assign has_care = false

            if product.metafields.custom.material.value != blank or product.metafields.custom.spec_material.value != blank
              assign has_material = true
            endif
            if product.metafields.custom.fit.value != blank or product.metafields.custom.spec_fit.value != blank
              assign has_fit = true
            endif
            if product.metafields.custom.print.value != blank or product.metafields.custom.spec_print.value != blank
              assign has_print = true
            endif
            if product.metafields.custom.care_instructions.value != blank
              assign has_care = true
            endif

            assign has_any_specs = false
            if has_material or has_fit or has_print or has_care
              assign has_any_specs = true
            endif
          -%}

          {%- if has_any_specs -%}
            <div class="product-main-trust__meta-card product-main-trust__meta-card--specs">
              <header class="product-main-trust__meta-header">
                <h2
                  id="brand-product-specs-heading"
                  class="product-main-trust__meta-title brand-details__heading brand-section-heading label-system label-tech"
                >
                  SPECIFICATIONS
                </h2>
              </header>
              <div class="product-main-trust__meta-body">
                <section class="brand-details__section" aria-labelledby="brand-product-specs-heading">
                  <dl class="brand-specs">
                  {%- if has_material -%}
                    <div class="brand-specs__item">
                      <dt class="brand-specs__label">MATERIAL</dt>
                      <dd class="brand-specs__value">
                        {% if product.metafields.custom.spec_material.value != blank %}
                          {{ product.metafields.custom.spec_material.value | escape }}
                        {% else %}
                          {{ product.metafields.custom.material.value | escape }}
                        {% endif %}
                      </dd>
                    </div>
                  {%- endif -%}

                  {%- if has_fit -%}
                    <div class="brand-specs__item">
                      <dt class="brand-specs__label">FIT</dt>
                      <dd class="brand-specs__value">
                        {% if product.metafields.custom.spec_fit.value != blank %}
                          {{ product.metafields.custom.spec_fit.value | escape }}
                        {% else %}
                          {{ product.metafields.custom.fit.value | escape }}
                        {% endif %}
                      </dd>
                    </div>
                  {%- endif -%}

                  {%- if has_print -%}
                    <div class="brand-specs__item">
                      <dt class="brand-specs__label">PRINT</dt>
                      <dd class="brand-specs__value">
                        {% if product.metafields.custom.spec_print.value != blank %}
                          {{ product.metafields.custom.spec_print.value | escape }}
                        {% else %}
                          {{ product.metafields.custom.print.value | escape }}
                        {% endif %}
                      </dd>
                    </div>
                  {%- endif -%}

                  {%- if has_care -%}
                    <div class="brand-specs__item">
                      <dt class="brand-specs__label">CARE</dt>
                      <dd class="brand-specs__value">
                        {{-
                          product.metafields.custom.care_instructions.value
                          | escape
                          | newline_to_br
                        -}}
                      </dd>
                    </div>
                  {%- endif -%}
                  </dl>
                </section>
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- comment -%} 3. REVIEWS.UGC {%- endcomment -%}
        {%- if section.settings.show_reviews_section -%}
          <div class="product-main-trust__meta-card product-main-trust__meta-card--reviews">
            <header class="product-main-trust__meta-header">
              <h2 id="brand-product-reviews-heading" class="product-main-trust__meta-title brand-details__heading">REVIEWS.UGC</h2>
            </header>
            <div class="product-main-trust__meta-body">
              <section
                class="brand-details__section"
                id="brand-product-reviews"
                aria-labelledby="brand-product-reviews-heading"
              >
                <div class="brand-details__reviews-placeholder">
                  <p>Review integration placeholder &bull; Connect your reviews app here</p>
                </div>
              </section>
            </div>
          </div>
        {%- endif -%}
      </div>
    </div>

  {%- comment -%} Minimal JS for Thumbnail Switching {%- endcomment -%}
  <script>
    (function() {
      const mainImage = document.getElementById('BrandMediaMain-{{ section.id }}');
      const thumbButtons = document.querySelectorAll('.brand-product__thumb-button');

      if (!mainImage || !thumbButtons.length) return;

      thumbButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all
          thumbButtons.forEach(btn => btn.classList.remove('is-active'));
          // Add active to clicked
          this.classList.add('is-active');

          // Get media data
          const mediaId = this.dataset.mediaId;
          const mediaPosition = this.dataset.mediaPosition;

          // Find the media in product.media
          {%- assign media_json = '' -%}
          {%- for media in product.media -%}
            {%- if forloop.first -%}
              {%- assign media_json = media_json | append: '[' -%}
            {%- endif -%}
            {%- assign media_json = media_json | append: '{"id":' | append: media.id | append: ',"src":"' | append: media | image_url: width: 1200 | append: '","alt":"' | append: media.alt | escape | append: '","width":' | append: media.width | append: ',"height":' | append: media.height | append: '}' -%}
            {%- unless forloop.last -%}
              {%- assign media_json = media_json | append: ',' -%}
            {%- endunless -%}
            {%- if forloop.last -%}
              {%- assign media_json = media_json | append: ']' -%}
            {%- endif -%}
          {%- endfor -%}

          const productMedia = {{ media_json | default: '[]' }};
          const selectedMedia = productMedia.find(m => m.id == mediaId);

          if (selectedMedia) {
            const img = mainImage.querySelector('img');
            if (img) {
              img.src = selectedMedia.src;
              img.alt = selectedMedia.alt;
              img.width = selectedMedia.width;
              img.height = selectedMedia.height;
            }
          }
        });
      });
    })();
  </script>
</section>

{% schema %}
{
  "name": "Product (Brand Neutral)",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_dynamic_checkout",
      "label": "Show express checkout buttons",
      "default": true
    },
    {
      "type": "header",
      "content": "Below-fold sections"
    },
    {
      "type": "checkbox",
      "id": "show_story_section",
      "label": "Show product story section",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_specs_section",
      "label": "Show specifications section",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_reviews_section",
      "label": "Show reviews section",
      "default": true
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "@app"
    }
  ],
  "presets": [
    {
      "name": "Product (Brand Neutral)"
    }
  ]
}
{% endschema %}
